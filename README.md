# 甜瓜游乐场 - 自动化搭建工具链

本项目是一套为 **《甜瓜游乐场》** 设计的强大自动化工具链，旨在将高层级的图谱设计稿转化为功能完备的复杂机械或 AI 逻辑。它将创作者从手动添加和连接成百上千个模块的繁重劳动中解放出来。

现在，您无需再通过鼠标拖拽进行搭建，只需在一个简单的 `graph.json` 文件中定义您的整个机械结构，本工具集即可为您生成一份可以直接在游戏中加载的存档。

## ✨ 核心功能

- **声明式设计**：在一个清晰、简洁的 `graph.json` 文件中设计您的整个作品，所见即所得。
- **批量节点创建**：根据您的图谱定义，自动在存档文件中批量添加所有必需的模块。告别逐一添加节点的时代！
- **精确端口连线**：完全按照您在图谱 `edges` 中指定的连接关系，精确地连接模块的输入/输出端口，并严格遵守端口顺序。
- **高层级抽象**：在设计图中使用简单、友好的名称（如 “加法器”, “常量”），工具会自动将其映射为游戏内部使用的复杂名称。
- **端到端自动化**：只需一条命令，即可运行从解析设计图到生成最终连线的完整流程。

## 📂 文件结构说明

本工具链由多个相互关联的 Python 脚本和配置文件组成：

- **主要脚本 (用户直接运行):**
  - `整合.py`: **主入口点。** 这个编排脚本负责控制整个自动化工作流。
  - `批量连线.py`: 流水线的最后一个脚本，负责将生成的连线指令写入最终存档。

- **核心模块 (底层依赖):**
  - `批量添加模块.py`: 负责向存档文件中批量添加多个模块的脚本。
  - `add_module.py`: 提供创建单个新节点核心逻辑的底层模块。

- **配置与数据 (由用户提供):**
  - `graph.json`: **您的设计蓝图。** 在这里定义您作品的节点和边（连接关系）。
  - `芯片名词.json`: **模块词典。** 它将您在 `graph.json` 中使用的友好名称（如 “加法器”）映射到游戏的内部名称，并定义其端口顺序。
  - `data.json`: 您的游戏存档底包（可以是一个只包含空 contraption 的存档）。
  - `allmod.json`: 从游戏中提取的、包含所有可用模块及其属性的完整列表。

- **生成的文件 (脚本输出):**
  - `modules.json`: 一个临时的 JSON 文件，用于告知“批量添加模块”脚本需要创建哪些模块。
  - `output.json`: 一个临时的 JSON 文件，包含了详细的连线指令。
  - `data_modified_batch.json`: 一个中间状态的存档文件，其中节点已添加但尚未连接。
  - `Data_modified.json`: **最终的输出成果！** 这就是您构建完成的存档文件，可直接加载进游戏。

## 🚀 使用方法 (分步指南)

### 准备工作

- 已安装 Python 3.x 环境。
- 本项目无需安装任何第三方 Python 库。

### 第一步：准备您的配置文件

1.  **在 `graph.json` 中完成您的设计**:
    定义所有您需要的节点（模块）和边（连接）。请使用与 `芯片名词.json` 中条目对应的友好名称作为 `type`。

    *`graph.json` 示例:*
    ```json
    {
      "nodes": [
        { "id": "input_A", "type": "常量" },
        { "id": "input_B", "type": "常量" },
        { "id": "adder", "type": "加法器" }
      ],
      "edges": [
        { "from_node": "input_A", "from_port": "输出", "to_node": "adder", "to_port": "输入A" }
      ]
    }
    ```

2.  **在 `芯片名词.json` 中定义模块属性**:
    为您在 `graph.json` 中使用的每一个友好名称，在此文件中创建一个对应的条目。明确指定其在游戏中的内部名称 `game_name`，以及 `inputs` 和 `outputs` 端口的**精确顺序**。这对保证连线正确至关重要。

    *`芯片名词.json` 示例:*
    ```json
    [
      {
        "friendly_name": "加法器",
        "game_name": "AddNumbersNodeViewModel",
        "inputs": ["输入A", "输入B"],
        "outputs": ["A+B"]
      }
    ]
    ```

3.  **提供必要的游戏文件**:
    - 将一个基础的 `data.json` 存档文件放置在脚本根目录。
    - 确保 `allmod.json` (包含所有模块定义) 文件也位于同一目录。

### 第二步：运行自动化流水线

整个流程通过两个主要命令实现自动化。

1.  **生成节点和连线方案:**
    运行主编排脚本。它会读取您的 `graph.json`，创建所有节点，并生成一份连线方案 (`output.json`)。

    ```bash
    python 整合.py
    ```

2.  **将连线方案应用到存档:**
    在第一个脚本成功执行后，运行批量连线脚本。它会读取 `output.json` 中的方案，并将最终的连线写入存档文件。

    ```bash
    python 批量连线.py
    ```

### 第三步：享受您的作品！

大功告成！现在，`Data_modified.json` 文件已经包含了您完整构建的机械。将其复制到您游戏的存档目录，然后在《甜瓜游乐场》中加载它吧。

## 💡 工作流解析

本工具的自动化流程由 `整合.py` 脚本通过一个清晰的多阶段过程进行编排：

1.  **解析图谱**: 读取 `graph.json` 和 `芯片名词.json`，以创建一份待添加的模块列表，并理解它们的端口结构。
2.  **运行批量添加**: 以子进程方式调用 `批量添加模块.py`，它负责将所有节点添加至 `data.json`，并生成中间文件 `data_modified_batch.json`。
3.  **捕获ID**: 智能地捕获上一步的控制台输出，从而获得每一个被新创建节点的唯一ID。
4.  **构建连线方案**: 它将您 `graph.json` 中的逻辑节点ID与新生成的物理ID进行映射，并根据您定义的 `edges` 和 `芯片名词.json` 中的端口顺序，创建一个精确的连线指令文件 (`output.json`)。
5.  **最终化连接**: 最后，运行独立的 `batch_connect.py` 脚本来应用这份方案，完成存档的最终构建。

这种健壮的流水线设计确保了即便是拥有成千上万节点和连接的宏伟设计，也能够被可靠且无误地在数秒内构建完成。